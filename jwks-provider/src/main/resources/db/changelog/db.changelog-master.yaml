databaseChangeLog:
  - changeSet:
      id: JsonWebKeyPair
      author: table
      changes:
        - createTable:
            tableName: json_web_key_pair
            columns:
              - column:
                  name: key_id
                  remarks: Key ID
                  type: CHAR(4)
                  constraints:
                    primaryKey: true
              - column:
                  name: jwk
                  remarks: JSON Web Key
                  type: MEDIUMTEXT
              - column:
                  name: expires_on
                  remarks: Expires on
                  type: TIMESTAMP
        - addNotNullConstraint:
            tableName: json_web_key_pair
            columnName: jwk
            columnDataType: MEDIUMTEXT
        - addNotNullConstraint:
            tableName: json_web_key_pair
            columnName: expires_on
            columnDataType: TIMESTAMP
        - addUniqueConstraint:
            tableName: json_web_key_pair
            constraintName: json_web_key_pair_key_id_uc
            columnNames: key_id
        - createIndex:
            tableName: json_web_key_pair
            indexName: json_web_key_pair_expires_on_idx
            columns:
              - column:
                  name: expires_on
  - changeSet:
      id: AccessToken
      author: table
      changes:
        - createTable:
            tableName: access_token
            columns:
              - column:
                  name: jti
                  remarks: JTI
                  type: CHAR(36)
                  constraints:
                    primaryKey: true
              - column:
                  name: expires_on
                  remarks: Expires on
                  type: TIMESTAMP
              - column:
                  name: key_id
                  remarks: Key ID
                  type: CHAR(4)
        - addNotNullConstraint:
            tableName: access_token
            columnName: expires_on
            columnDataType: TIMESTAMP
        - createIndex:
            tableName: access_token
            indexName: access_token_expires_on_idx
            columns:
              - column:
                  name: expires_on
  - changeSet:
      id: RefreshToken
      author: table
      changes:
        - createTable:
            tableName: refresh_token
            columns:
              - column:
                  name: uuid
                  remarks: UUID
                  type: CHAR(36)
                  constraints:
                    primaryKey: true
              - column:
                  name: jti
                  remarks: JTI
                  type: CHAR(36)
              - column:
                  name: token
                  remarks: The token sent back and forth between client and server.
                  type: VARCHAR(1024)
              - column:
                  name: secret_claims
                  remarks: Secret claims
                  type: MEDIUMTEXT
              - column:
                  name: issued_on
                  remarks: Initially issued on
                  type: TIMESTAMP
              - column:
                  name: expires_on
                  remarks: Expires on
                  type: TIMESTAMP
              - column:
                  name: key_id
                  remarks: Key ID
                  type: CHAR(4)
              - column:
                  name: version_no
                  remarks: Optimistic locking version number
                  type: INTEGER
        - addNotNullConstraint:
            tableName: refresh_token
            columnName: jti
            columnDataType: CHAR(36)
        - addNotNullConstraint:
            tableName: refresh_token
            columnName: token
            columnDataType: VARCHAR(1024)
        - addNotNullConstraint:
            tableName: refresh_token
            columnName: secret_claims
            columnDataType: MEDIUMTEXT
        - addNotNullConstraint:
            tableName: refresh_token
            columnName: issued_on
            columnDataType: TIMESTAMP
        - addNotNullConstraint:
            tableName: refresh_token
            columnName: expires_on
            columnDataType: TIMESTAMP
        - addNotNullConstraint:
            tableName: refresh_token
            columnName: version_no
            columnDataType: INTEGER
        - addUniqueConstraint:
            tableName: refresh_token
            constraintName: refresh_token_jti_uc
            columnNames: jti
        - createIndex:
            tableName: refresh_token
            indexName: refresh_token_expires_on_idx
            columns:
              - column:
                  name: expires_on
  - changeSet:
      id: BlockSigningKey
      author: table
      changes:
        - createTable:
            tableName: block_signing_key
            columns:
              - column:
                  name: uuid
                  remarks: UUID
                  type: CHAR(36)
                  constraints:
                    primaryKey: true
              - column:
                  name: epoch_seconds_block
                  remarks: The start of epoch seconds block.JTI
                  type: BIGINT
              - column:
                  name: key_id
                  remarks: Key ID
                  type: CHAR(4)
        - addNotNullConstraint:
            tableName: block_signing_key
            columnName: epoch_seconds_block
            columnDataType: BIGINT
        - addNotNullConstraint:
            tableName: block_signing_key
            columnName: key_id
            columnDataType: CHAR(4)
        - addUniqueConstraint:
            tableName: block_signing_key
            constraintName: block_signing_key_epoch_seconds_block_key_id_uc
            columnNames: epoch_seconds_block, key_id
        - createIndex:
            tableName: block_signing_key
            indexName: block_signing_key_epoch_seconds_block_idx
            columns:
              - column:
                  name: epoch_seconds_block
  - changeSet:
      id: BlockSigningKey-JsonWebKeyPair
      author: fk
      changes:
        - addForeignKeyConstraint:
            baseTableName: block_signing_key
            baseColumnNames: key_id
            referencedTableName: json_web_key_pair
            referencedColumnNames: key_id
            constraintName: block_signing_key_json_web_key_pair_fk
  - changeSet:
      id: AccessToken-RefreshToken
      author: fk
      changes:
        - addForeignKeyConstraint:
            baseTableName: access_token
            baseColumnNames: jti
            referencedTableName: refresh_token
            referencedColumnNames: jti
            constraintName: access_token_refresh_token_fk
  - changeSet:
      id: AccessToken-JsonWebKeyPair
      author: fk
      changes:
        - addForeignKeyConstraint:
            baseTableName: access_token
            baseColumnNames: key_id
            referencedTableName: json_web_key_pair
            referencedColumnNames: key_id
            constraintName: access_token_json_web_key_pair_fk
  - changeSet:
      id: RefreshToken-JsonWebKeyPair
      author: fk
      changes:
        - addForeignKeyConstraint:
            baseTableName: refresh_token
            baseColumnNames: key_id
            referencedTableName: json_web_key_pair
            referencedColumnNames: key_id
            constraintName: refresh_token_json_web_key_pair_fk
