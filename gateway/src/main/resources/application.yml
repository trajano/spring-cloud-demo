cloud:
  aws:
    s3:
      # This is to make it bypass the error message when AWS is not enabled.
      region: us-east-2
spring:
  jmx:
    enabled: true
  redis:
    lettuce:
      pool:
        max-wait: 2s
  sleuth:
    reactor:
      instrumentation-type: decorate_queues
    trace-id128: true
  main:
    banner-mode: "off"
  cache:
    type: redis
  cloud:
    discovery:
      client:
        health-indicator:
          enabled: true
      enabled: true
      reactive:
        enabled: true
    circuitbreaker:
      resilience4j:
        reactive:
          enabled: true
        enabled: true
    gateway:
      # https://cloud.spring.io/spring-cloud-gateway/reference/html/appendix.html
      globalcors:
        add-to-simple-url-handler-mapping: true
        cors-configurations:
          '[/**]':
#            allowedOrigins: "*"
            allowCredentials: false
            allowedMethods:
              - GET
              - PUT
              - POST
              - DELETE
              - PATCH
      httpclient:
        connect-timeout: 10000
        response-timeout: 20s
#      fail-on-route-definition-error: false
#      routes:
#        - id: after_route
#          uri: http://whoami2
#          predicates:
#            - Path=/who
      discovery:
        locator:
          enabled: true
#          url-expression: "uri"
          predicates:
            - name: Path
              args:
                patterns: "metadata['path']"
          filters:
#            - name: RequestRateLimiter
#              args:
#                redis-rate-limiter.replenishRate: 10
#                redis-rate-limiter.burstCapacity: 20
#                redis-rate-limiter.requestedTokens: 1
            - RemoveRequestHeader='Cookie'
            - RemoveRequestHeader='X-Jwt-Assertion'
            # Prevent propagation of traces
            - RemoveRequestHeader='X-Amzn-Trace-Id'
            - RemoveRequestHeader='X-B3-TraceId'
            - RemoveRequestHeader='X-Trace-ID'
            - name: ProtectedResource
              args:
                serviceId: serviceId
            - name: Retry
              args:
                retries: 3
              methods:
                - GET
            - name: RewritePath
              args:
                regexp: "metadata['path.regexp']"
                replacement: "metadata['path.replacement']"
            - name: CircuitBreaker
              args:
                name: "'resilience'"
                fallbackUri: "'forward:/unavailable'"
            - name: Grpc
              args:
                serviceId: serviceId
                host: host
                useGrpc: "metadata['protocol'] == 'grpc'"
                port: port
      routes:
        - id: hello
          uri: http://example.org
          predicates:
            - Path=/hello
          filters:
            - name: Hello
              args:
                useHello: true
#    inetutils:
#      ignoredInterfaces:
#        - docker0
#        - veth.*
#        - eth3
    loadbalancer:
      ribbon:
        enabled: false
#      cache:
#        enabled: false
resilience4j:
  circuitbreaker:
    instances:
      resilience:
        registerHealthIndicator: true
        slidingWindowSize: 100
  timelimiter:
    instances:
      resilience:
        timeoutDuration: 5s
        cancelRunningFuture: true

management:
  health:
    redis:
      enabled: true
#  endpoint.gateway.enabled: true # default value
  endpoint:
    health:
      enabled: true
      show-details: ALWAYS
  endpoints:
#    enabled-by-default: false
    jmx:
      exposure:
        include: health
    web:
      exposure:
        #include: health,gateway,info,caches
        include: "*"
#logging:
#  level:
#    org.springframework.cloud.gateway.route.RouteDefinitionRouteLocator: warn
#    request: error
#    root: warn
##    root: debug

simple-auth:
  enabled: true
